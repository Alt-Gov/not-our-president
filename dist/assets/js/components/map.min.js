!function(){const t=window.APP_CONFIG||{};mapboxgl.accessToken=t.mapboxToken;const e=t.mapStyle||"mapbox://styles/lynnstahl/cmhc3o1h5004q01qu3snzehqi",o="county_fips",n=t.countyLookupUrl||"snap_households_county_2020_2024.json";let a={},l=2024;const i=["#e0938d","#d06f68","#bb4f47","#a73f37","#8e342e"],s=new mapboxgl.Map({container:"map",style:e,center:[0,0],zoom:5,minZoom:3,maxZoom:12,renderWorldCopies:!1});async function c(t){const e=a[String(t)]||{};return Object.entries(e).filter(([,t])=>Number.isFinite(t)&&t>0).map(([t,e])=>({fips:t.padStart(5,"0"),value:e}))}function r(t){const e=t.map(t=>t.value),n=e.map(t=>Math.log10(t)),a=Math.min(...n),l=Math.max(...n),s=(l-a)/(i.length-1),c=[];for(let t=0;t<i.length;t++)c.push(a+s*t,i[t]);console.log("[SNAP] Color scale log10 min:",a.toFixed(2),"max:",l.toFixed(2));const r=["match",["slice",["concat",["to-string",["get",o]]],-5]];return t.forEach(t=>{const e=Math.log10(t.value),o=Math.min(i.length-1,Math.floor((e-a)/(s||1e-6)));r.push(t.fips,i[o])}),r.push("#ccc"),function(t,e){const o=document.querySelector("#legend .swatches");if(!o)return;o.innerHTML="";const n=t.map(t=>Math.log10(t)),a=Math.min(...n),l=(Math.max(...n)-a)/(e.length-1);for(let t=0;t<e.length;t++){const n=Math.pow(10,a+l*t),i=Math.pow(10,a+l*(t+1)),s=t===e.length-1?`>${Math.round(n).toLocaleString()}`:`${Math.round(n).toLocaleString()}â€“${Math.round(i).toLocaleString()}`,c=document.createElement("div");c.className="swatch",c.innerHTML=`\n      <div class="color-box" style="background:${e[t]}"></div>\n      <div class="label">${s}</div>`,o.appendChild(c)}}(e,i),r}function p(t){const e=["match",["slice",["concat",["to-string",["get","county_fips"]]],-5]];for(const o of t)e.push(o.fips,o.value.toLocaleString());return e.push(""),e}s.addControl(new mapboxgl.NavigationControl({showCompass:!1}),"top-right"),s.addControl(new mapboxgl.ScaleControl({maxWidth:120,unit:"imperial"})),window.addEventListener("resize",()=>s.resize()),s.on("load",async()=>{const t=await fetch(n);if(!t.ok)throw new Error(`Failed to fetch ${n}`);a=await t.json();const e=Object.keys(a).map(Number).sort();l=e[e.length-1];const i=await c(l),u=["in",["slice",["concat",["to-string",["get",o]]],-5],["literal",i.map(t=>t.fips)]],d=r(i),m=s.getLayer("county-boundaries")?"county-boundaries":void 0;s.addLayer({id:"snap-counties-fill",type:"fill",source:"composite","source-layer":"albersusa",filter:u,paint:{"fill-color":d,"fill-opacity":.85}},m);const h=["in",["slice",["concat",["to-string",["get","county_fips"]]],-5],["literal",i.map(t=>t.fips)]],f=p(i);s.getLayer("snap-counties-labels")||s.addLayer({id:"snap-counties-labels",type:"symbol",source:"composite","source-layer":"albersusa-points",filter:h,layout:{"text-field":f,"text-font":["Inter Medium","Arial Unicode MS Regular"],"text-size":["interpolate",["linear"],["zoom"],4,9,6,10.5,8,12,10,13],"text-anchor":"center","symbol-placement":"point","text-allow-overlap":!1},paint:{"text-color":"#fff","text-halo-width":1.2,"text-halo-blur":.5,"text-opacity":["interpolate",["linear"],["zoom"],4,0,5.5,.75,7,1]},minzoom:8},"county-boundaries"),document.querySelectorAll("#year-controls button").forEach(t=>{t.addEventListener("click",()=>async function(t){l=t;const e=await c(t);console.log(`[SNAP] Updating to FY${t}, ${e.length} counties`);const n=["in",["slice",["concat",["to-string",["get",o]]],-5],["literal",e.map(t=>t.fips)]],a=r(e);s.getLayer("snap-counties-fill")&&(s.setFilter("snap-counties-fill",n),s.setPaintProperty("snap-counties-fill","fill-color",a));const i=["in",["slice",["concat",["to-string",["get","county_fips"]]],-5],["literal",e.map(t=>t.fips)]],u=p(e);s.getLayer("snap-counties-labels")&&(s.setFilter("snap-counties-labels",i),s.setLayoutProperty("snap-counties-labels","text-field",u)),document.querySelectorAll("#year-controls button").forEach(e=>{e.classList.toggle("active",e.dataset.year===String(t))})}(t.dataset.year))}),console.log("[SNAP] Map ready, initial year:",l)})}();
//# sourceMappingURL=map.min.js.map
